<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>登陆 - 钱路书院</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="assets/css/font-awesome.min.css" />
	<!--[if IE 7]>
	  <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
	<![endif]-->
	<link rel="stylesheet" href="assets/css/ace-fonts.css" />
	<!-- ace styles -->
	<link rel="stylesheet" href="assets/css/ace.min.css" />
	<link rel="stylesheet" href="assets/css/ace-rtl.min.css" />
	<!--[if lte IE 8]>
	  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
	<![endif]-->
	<!-- inline styles related to this page -->
	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	<script src="assets/js/html5shiv.js"></script>
	<script src="assets/js/respond.min.js"></script>
	<![endif]-->
</head>
	<body class="login-layout" ng-app="signApp">
		<div class="main-container">
			<div class="main-content">
				<div class="row">
					<div class="col-sm-10 col-sm-offset-1" ng-controller="SignCtrl">
						<div class="login-container">
							<div class="center">
								<h1>
									<i class="icon-leaf green"></i>
									<span class="red">钱路</span>
									<span class="white">书院</span>
								</h1>
								<h4 class="blue">&copy; 专注传播世上赚钱钱路策略</h4>
								<h5 class="red" ng-bind="msg"></h5>
							</div>

							<div class="space-6"></div>


							<div class="position-relative">
								<div id="login-box" class="login-box visible widget-box no-border">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header blue lighter bigger">
												<i class="icon-coffee green"></i>
												会员登陆
											</h4>

											<div class="space-6"></div>

											<form>
												<fieldset>
													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="text" class="form-control" ng-model="username" placeholder="用户名或注册手机号" />
															<i class="icon-user"></i>
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" class="form-control" ng-model="password" placeholder="密码" />
															<i class="icon-lock"></i>
														</span>
													</label>

													<div class="space"></div>

													<div class="clearfix">
														<label class="inline">
															<input type="checkbox" class="ace" />
															<span class="lbl"> 记住我</span>
														</label>

														<button type="button" class="width-35 pull-right btn btn-sm btn-primary" ng-click="signin()">
															<i class="icon-key"></i>
															登陆
														</button>
													</div>

													<div class="space-4"></div>
												</fieldset>
											</form>

										</div><!-- /widget-main -->

										<div class="toolbar clearfix">
											<div>
												<a href="#" onclick="show_box('forgot-box'); return false;" class="forgot-password-link">
													<i class="icon-arrow-left"></i>
													忘记密码了？
												</a>
											</div>

											<div>
												<a href="#" onclick="show_box('signup-box'); return false;" class="user-signup-link">
													我要注册
													<i class="icon-arrow-right"></i>
												</a>
											</div>
										</div>
									</div><!-- /widget-body -->
								</div><!-- /login-box -->

								<div id="forgot-box" class="forgot-box widget-box no-border">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header red lighter bigger">
												<i class="icon-key"></i>
												重置密码
											</h4>

											<form>
												<fieldset>
													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="text" class="form-control" ng-model="username" placeholder="用户名或手机号" />
															<i class="icon-envelope"></i>
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<div class="input-group">
																<input type="text" class="form-control" ng-model="sms" placeholder="输入验证码" />
																<span class="input-group-btn">
																	<button class="btn btn-sm btn-default" type="button" ng-disabled="smsDisable" ng-click="sendSms()">
																		<i class="icon-calendar bigger-110"></i>{{smsCaption}}!
																	</button>
																</span>
															</div>	
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" class="form-control" ng-model="password" placeholder="设定新密码" />
															<i class="icon-retweet"></i>
														</span>
													</label>

													<div class="space-24"></div>

													<div class="clearfix">
														<button type="button" class="width-35 pull-right btn btn-sm btn-danger" ng-click="forget()">
															<i class="icon-lightbulb"></i>
															登陆!
														</button>
													</div>
												</fieldset>
											</form>
										</div><!-- /widget-main -->

										<div class="toolbar center">
											<a href="#" onclick="show_box('login-box'); return false;" class="back-to-login-link">
												返回登陆
												<i class="icon-arrow-right"></i>
											</a>
										</div>
									</div><!-- /widget-body -->
								</div><!-- /forgot-box -->

								<div id="signup-box" class="signup-box widget-box no-border">
									<div class="widget-body">
										<div class="widget-main">
											<h4 class="header green lighter bigger">
												<i class="icon-group blue"></i>
												新用户注册
											</h4>

											<div class="space-6"></div>
											<p> 输入您的注册信息: </p>

											<form>
												<fieldset>
													<label class="block clearfix">
														<spusernamean class="block input-icon input-icon-right">
															<input type="text" class="form-control" ng-model="username" placeholder="会员名" />
															<i class="icon-user"></i>
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="text" class="form-control" ng-model="_id" placeholder="手机号" />
															<i class="icon-envelope"></i>
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<div class="input-group">
																<input type="text" class="form-control" ng-model="sms" placeholder="输入验证码" />
																<span class="input-group-btn">
																	<button class="btn btn-sm btn-default" type="button" ng-disabled="smsDisable" ng-click="sendSms()">
																		<i class="icon-calendar bigger-110"></i>{{smsCaption}}!
																	</button>
																</span>
															</div>	
														</span>
													</label>

													<label class="block clearfix">
														<span class="block input-icon input-icon-right">
															<input type="password" class="form-control" ng-model="password" placeholder="设定密码" />
															<i class="icon-retweet"></i>
														</span>
													</label>

													<label class="block">
														<input type="checkbox" class="ace" />
														<span class="lbl">
															我同意邻客
															<a href="#">会员协议</a>
														</span>
													</label>

													<div class="space-24"></div>

													<div class="clearfix">
														<button type="reset" class="width-30 pull-left btn btn-sm" ng-click="reset()">
															<i class="icon-refresh"></i>
															重置
														</button>

														<button type="button" class="width-65 pull-right btn btn-sm btn-success" ng-click="signup()">
															注册
															<i class="icon-arrow-right icon-on-right"></i>
														</button>
													</div>
												</fieldset>
											</form>
										</div>

										<div class="toolbar center">
											<a href="#" onclick="show_box('login-box'); return false;" class="back-to-login-link">
												<i class="icon-arrow-left"></i>
												返回登陆
											</a>
										</div>
									</div><!-- /widget-body -->
								</div><!-- /signup-box -->
							</div><!-- /position-relative -->
						</div>
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div>
		</div><!-- /.main-container -->

		<!-- basic scripts -->

		<!--[if !IE]> -->
		<script type="text/javascript">
			window.jQuery || document.write("<script src='http://cdn.bootcss.com/jquery/2.1.1/jquery.min.js'>"+"<"+"/script>");
		</script>

		<!-- <![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js'>"+"<"+"/script>");
</script>
<![endif]-->
		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>

		<!-- inline scripts related to this page -->

		<script type="text/javascript">
			function show_box(id) {
			 jQuery('.widget-box.visible').removeClass('visible');
			 jQuery('#'+id).addClass('visible');
			}
		</script>
	<script src="http://cdn.bootcss.com/angular.js/1.2.16/angular.min.js"></script>
	<script type="text/javascript">
		'use strict';
		angular.module("signApp",[]).controller("SignCtrl",["$scope","$rootScope","$timeout","$http","$window",function($scope,$rootScope,$timeout,$http,$window){
			$scope._id="";
			$scope.username="";
			$scope.password="";
			$scope.sms="";
			$scope.smsCaption="发送验证码";
			$scope.smsDisable = false;
			$scope.interval = 60;
			function leftCount(){
				$scope.interval--;
				if($scope.interval < 0){
					$scope.smsCaption = "发送验证码";
					$scope.smsDisable = false;
				}else{
					$scope.smsCaption = $scope.interval + " 秒后再次发送";
					$scope.smsDisable = true;
					$timeout(leftCount, 1000);
				}
			}
			$scope.sendSms = function(){
				//这里调用sms发送验证码
				$http.post('/api/signsms',{_id:$scope._id, org:'钱路书院'}).success(function(data){
					//这里设定倒计时
					$scope.interval = 6;
					leftCount();	
				})
			};
			$scope.signup = function(){
				$http.post('/api/signup',{_id:$scope._id, username:$scope.username, sms:$scope.sms, password:$scope.password}).success(function(data){
					console.log(data);
					if(data.error){
						$scope.msg = data.error;
					}else{
						$window.sessionStorage.token = data.token;
						$window.location.href = '/my';
						//$location.path('my');
					}
				})
			};
			$scope.signin = function(){
				$http.post('/api/signin',{username:$scope.username, password:$scope.password}).success(function(data){
					console.log(data);
					if(data.error){
						$scope.msg = data.error;
					}else{

						$window.sessionStorage.token = data.token;
						$window.location.href = '/my';
					}
				})
			}
			$scope.forget = function(){
				$http.forget('/api/forget',{username:$scope.username, password:$scope.password}).success(function(data){
					console.log(data);
					if(data.error){
						$scope.msg = data.error;
					}else{
						$window.sessionStorage.token = data.token;
						$window.location.href = '/my';
					}
				})
			}
		}])
		.run(['$rootScope', '$location', '$window', '$http', function ($rootScope, $location, $window, $http) {
			if($window.sessionStorage && $window.sessionStorage.token){
				$window.location.href = "/my";
			}
		}]);


	</script>

	</body>

</html>
